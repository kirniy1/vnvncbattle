<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VNVNC Concert Hall Coin Tapper</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        #coin {
            width: 100px;
            height: 100px;
            background-color: gold;
            border-radius: 50%;
            margin: 20px auto;
            cursor: pointer;
            user-select: none;
        }
        #progressBar {
            width: 100%;
            height: 20px;
            background-color: #ddd;
            margin-bottom: 20px;
        }
        #progress {
            width: 0%;
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.5s;
        }
        button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
        }
        #bottomMenu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #333;
            padding: 10px 0;
        }
        #bottomMenu button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
       .coin-animation {
            animation: coinTap 0.2s ease-in-out;
        }

        @keyframes coinTap {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div id="tappingPage">
        <h1>VNVNC Concert Hall Coin Tapper</h1>
        <p>Stars: <span id="stars">0</span></p>
        <div id="progressBar"><div id="progress"></div></div>
        <p>Tapping Points: <span id="tappingPoints">2000</span> / 2000</p>
        <div id="coin"></div>
    </div>
    <div id="boosterPage" style="display:none;">
        <h2>Boosters</h2>
        <button id="tappingGuru">Tapping Guru (2x for 5min)</button>
        <button id="fullTank">Full Tank</button>
        <button id="multitap">Multitap (5x for 3h) - 500 stars</button>
        <button id="rechargingSpeed">Recharging Speed (3x for 3h) - 2000 stars</button>
    </div>
    <div id="bottomMenu">
        <button id="tappingPageBtn">Tapping</button>
        <button id="boosterPageBtn">Boosters</button>
    </div>

    <script>
        const tgWebApp = window.Telegram.WebApp;
        let userId;
        let isFirstLaunch = true;

        // Function to show welcome popup
        function showWelcomePopup() {
            tgWebApp.showPopup({
                title: 'Welcome to VNVNC Concert Hall Coin Tapper!',
                message: 'Tap the coin to earn stars and unlock boosters. Your progress will be saved automatically.',
                buttons: [{text: 'Start Tapping!', type: 'ok'}]
            });
        }

        let stars = 0;
        let tappingPoints = 2000;
        const maxTappingPoints = 2000;
        let tappingMultiplier = 1;
        let rechargeMultiplier = 1;
        let tappingGuruUses = 3;
        let fullTankUses = 3;
        let lastSaveTime = Date.now();

        const starsElement = document.getElementById('stars');
        const tappingPointsElement = document.getElementById('tappingPoints');
        const progressElement = document.getElementById('progress');
        const coinElement = document.getElementById('coin');
        const tappingPageElement = document.getElementById('tappingPage');
        const boosterPageElement = document.getElementById('boosterPage');

        // Initialize Telegram WebApp
        tgWebApp.ready();

        // Check if user data is available
        if (tgWebApp.initDataUnsafe && tgWebApp.initDataUnsafe.user) {
            userId = tgWebApp.initDataUnsafe.user.id;
            checkFirstLaunch();
        } else {
            console.error('User data not available');
            tgWebApp.showAlert('Error: Unable to retrieve user data. Please try again later.');
        }

        function checkFirstLaunch() {
            tgWebApp.CloudStorage.getItem(`user_${userId}_launched`, (error, result) => {
                if (error || !result) {
                    isFirstLaunch = true;
                    showWelcomePopup();
                    tgWebApp.CloudStorage.setItem(`user_${userId}_launched`, 'true');
                } else {
                    isFirstLaunch = false;
                }
                loadUserData(); // Load user data after checking first launch
            });
        }

        // Load user data
        function loadUserData() {
            tgWebApp.CloudStorage.getItem(`user_${userId}_data`, (error, result) => {
                if (error) {
                    console.error('Error loading user data:', error);
                } else if (result) {
                    const userData = JSON.parse(result);
                    stars = userData.stars || 0;
                    tappingPoints = userData.tappingPoints || maxTappingPoints;
                    tappingGuruUses = userData.tappingGuruUses || 3;
                    fullTankUses = userData.fullTankUses || 3;
                    lastSaveTime = userData.lastSaveTime || Date.now();
                    updateUI();
                }
            });
        }

        // Save user data
        function saveUserData() {
            const userData = {
                stars: stars,
                tappingPoints: tappingPoints,
                tappingGuruUses: tappingGuruUses,
                fullTankUses: fullTankUses,
                lastSaveTime: Date.now()
            };
            tgWebApp.CloudStorage.setItem(`user_${userId}_data`, JSON.stringify(userData), (error, result) => {
                if (error) {
                    console.error('Error saving user data:', error);
                } else {
                    console.log('User data saved successfully');
                }
            });
        }

        // Update UI
        function updateUI() {
            starsElement.textContent = stars;
            tappingPointsElement.textContent = tappingPoints;
            progressElement.style.width = `${(tappingPoints / maxTappingPoints) * 100}%`;
        }

      // Coin tapping
        coinElement.addEventListener('click', () => {
            if (tappingPoints > 0) {
                stars += tappingMultiplier;
                tappingPoints--;
                updateUI();
                saveUserData();

                // Coin animation
                coinElement.classList.add('coin-animation');
                setTimeout(() => {
                    coinElement.classList.remove('coin-animation');
                }, 200);
            }
        });

        // Recharge tapping points
        setInterval(() => {
            if (tappingPoints < maxTappingPoints) {
tappingPoints += rechargeMultiplier;
if (tappingPoints > maxTappingPoints) {
tappingPoints = maxTappingPoints;
}
updateUI();
saveUserData();
}
}, 1000); // Recharge every second

    // Booster: Tapping Guru
    document.getElementById('tappingGuru').addEventListener('click', () => {
        if (tappingGuruUses > 0) {
            tappingMultiplier = 2;
            tappingGuruUses--;
            setTimeout(() => {
                tappingMultiplier = 1;
            }, 5 * 60 * 1000); // 5 minutes
            updateBoosterButtonStates();
            window.Telegram.WebApp.showAlert('Tapping Guru activated for 5 minutes!');
        } else {
            window.Telegram.WebApp.showAlert('No more Tapping Guru uses left for today!');
        }
    });

    // Booster: Full Tank
    document.getElementById('fullTank').addEventListener('click', () => {
        if (fullTankUses > 0) {
            tappingPoints = maxTappingPoints;
            fullTankUses--;
            updateUI();
            updateBoosterButtonStates();
            window.Telegram.WebApp.showAlert('Full Tank activated!');
        } else {
            window.Telegram.WebApp.showAlert('No more Full Tank uses left for today!');
        }
    });

    // Booster: Multitap
    document.getElementById('multitap').addEventListener('click', () => {
        if (stars >= 500) {
            stars -= 500;
            tappingMultiplier = 5;
            setTimeout(() => {
                tappingMultiplier = 1;
            }, 3 * 60 * 60 * 1000); // 3 hours
            updateUI();
            saveUserData();
            window.Telegram.WebApp.showAlert('Multitap activated for 3 hours!');
        } else {
            window.Telegram.WebApp.showAlert('Not enough stars to activate Multitap!');
        }
    });

    // Booster: Recharging Speed
    document.getElementById('rechargingSpeed').addEventListener('click', () => {
        if (stars >= 2000) {
            stars -= 2000;
            rechargeMultiplier = 3;
            setTimeout(() => {
                rechargeMultiplier = 1;
            }, 3 * 60 * 60 * 1000); // 3 hours
            updateUI();
            saveUserData();
            window.Telegram.WebApp.showAlert('Recharging Speed increased for 3 hours!');
        } else {
            window.Telegram.WebApp.showAlert('Not enough stars to activate Recharging Speed!');
        }
    });

    // Navigation
    document.getElementById('tappingPageBtn').addEventListener('click', () => {
        tappingPageElement.style.display = 'block';
        boosterPageElement.style.display = 'none';
    });

    document.getElementById('boosterPageBtn').addEventListener('click', () => {
        tappingPageElement.style.display = 'none';
        boosterPageElement.style.display = 'block';
        updateBoosterButtonStates();
    });

    // Update booster button states
    function updateBoosterButtonStates() {
        document.getElementById('tappingGuru').disabled = tappingGuruUses === 0;
        document.getElementById('fullTank').disabled = fullTankUses === 0;
    }

    // Save data periodically
    setInterval(saveUserData, 60000); // Save every minute
</script>
</body> 
</html> 
